<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Alberto Lem ¬∑ 2026</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      --bg1:#041c2d;
      --bg2:#0b4f7a;

      --glass: rgba(255,255,255,.12);
      --stroke: rgba(255,255,255,.22);
      --shadow: 0 22px 70px rgba(0,0,0,.45);

      --txt: rgba(255,255,255,.96);
      --sub: rgba(255,255,255,.86);
      --muted: rgba(255,255,255,.72);

      --glowA: rgba(44,198,255,.40);
      --glowB: rgba(255,108,201,.26);
      --glowC: rgba(255,225,120,.18);

      --linkedin:#0A66C2;
      --radius: 28px;

      --ok: rgba(88, 255, 160, .95);
      --warn: rgba(255, 206, 84, .95);
      --err: rgba(255, 90, 90, .95);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--txt);
      background:var(--bg1);
      overflow:hidden;
    }

    /* Fondo suave */
    .bg{
      position:fixed; inset:-60px;
      background:
        radial-gradient(900px 520px at 15% 18%, var(--glowA), transparent 70%),
        radial-gradient(820px 540px at 85% 20%, var(--glowB), transparent 70%),
        radial-gradient(1100px 680px at 50% 92%, var(--glowC), transparent 70%),
        linear-gradient(180deg, var(--bg2) 0%, var(--bg1) 70%);
      animation:bgMove 10s ease-in-out infinite alternate;
      filter:saturate(115%);
    }
    @keyframes bgMove{
      to{ transform:translate(-14px,8px) scale(1.02); }
    }

    /* Nieve (Canvas) */
    #snowCanvas{
      position:fixed;
      inset:0;
      width:100vw;
      height:100vh;
      z-index:0;
      pointer-events:none;
      opacity:.95;
    }

    .wrap{
      position:relative;
      z-index:1;
      min-height:100vh;
      display:grid;
      place-items:center;
      padding:22px;
    }

    .card{
      width:min(980px, 95vw);
      padding:44px 36px;
      border-radius:var(--radius);
      background:var(--glass);
      border:1px solid var(--stroke);
      backdrop-filter: blur(14px);
      box-shadow:var(--shadow);
      text-align:center;
      position:relative;
      overflow:hidden;
      animation: enter .7s cubic-bezier(.2,.8,.2,1) forwards;
      transform: translateZ(0);
    }
    @keyframes enter{
      from{opacity:0; transform:translateY(14px) scale(.985)}
      to{opacity:1; transform:translateY(0) scale(1)}
    }

    /* borde luminoso sutil */
    .card::before{
      content:"";
      position:absolute; inset:0;
      border-radius:var(--radius);
      pointer-events:none;
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,.14),
        0 0 40px rgba(44,198,255,.10),
        0 0 60px rgba(255,108,201,.08);
      opacity:.9;
      z-index:0;
    }

    /* brillo que cruza */
    .sheen{
      position:absolute;
      inset:-40%;
      background: linear-gradient(120deg,
        transparent 35%,
        rgba(255,255,255,.10) 45%,
        rgba(255,255,255,.16) 50%,
        rgba(255,255,255,.10) 55%,
        transparent 65%
      );
      transform: translateX(-40%) rotate(10deg);
      animation: sheenMove 7.5s ease-in-out infinite;
      pointer-events:none;
      opacity:.55;
      z-index:1;
    }
    @keyframes sheenMove{
      0%   { transform: translateX(-55%) rotate(10deg); opacity:.12; }
      35%  { opacity:.55; }
      65%  { opacity:.55; }
      100% { transform: translateX(55%) rotate(10deg); opacity:.12; }
    }

    .card > *{ position:relative; z-index:2; }

    .toprow{
      display:flex;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:12px;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:8px 12px;
      border-radius:999px;
      background:rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.14);
      color:var(--muted);
      font-size:13px;
      user-select:none;
    }

    .dot{
      width:10px; height:10px;
      border-radius:999px;
      background: rgba(44,198,255,.95);
      animation: pulse 1.6s ease-out infinite;
      box-shadow: 0 0 0 rgba(44,198,255,.35);
    }
    .dot.ok{ background: var(--ok); }
    .dot.warn{ background: var(--warn); }
    .dot.err{ background: var(--err); }

    @keyframes pulse{
      0%   { box-shadow: 0 0 0 0 rgba(44,198,255,.35); }
      70%  { box-shadow: 0 0 0 10px rgba(44,198,255,0); }
      100% { box-shadow: 0 0 0 0 rgba(44,198,255,0); }
    }

    .name{
      font-size:32px;
      font-weight:950;
      margin:10px 0 6px;
      text-shadow: 0 10px 26px rgba(0,0,0,.35);
    }
    .year{
      font-size:14px;
      letter-spacing:3px;
      opacity:.85;
      margin-bottom:18px;
    }

    h1{
      font-size:clamp(28px,5vw,50px);
      margin:10px 0 14px;
      font-weight:950;
      line-height:1.1;
    }

    p{
      max-width:72ch;
      margin:0 auto 18px;
      font-size:clamp(15px,2.4vw,18px);
      line-height:1.65;
      color:var(--sub);
    }

    .dynamic{
      margin-top:18px;
      font-size:clamp(16px,2.6vw,19px);
      font-weight:900;
      min-height:2.7em;
      letter-spacing:.2px;
      text-shadow: 0 10px 26px rgba(0,0,0,.25);
    }
    .cursor{
      display:inline-block;
      width:10px;
      transform: translateY(1px);
      margin-left:4px;
      opacity:.9;
      animation: blink .9s steps(2) infinite;
    }
    @keyframes blink{
      0%, 49% { opacity: 1; }
      50%, 100% { opacity: 0; }
    }

    .meta{
      margin-top:18px;
      display:flex;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
      font-size:13px;
      color:var(--muted);
    }
    .pill{
      padding:9px 14px;
      border-radius:999px;
      background:rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.12);
      transition: transform .15s ease, background .15s ease;
      user-select:none;
    }
    .pill:hover{
      transform: translateY(-1px);
      background: rgba(0,0,0,.22);
    }

    .actions{
      margin-top:26px;
      display:flex;
      justify-content:center;
      gap:14px;
      flex-wrap:wrap;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:13px 20px;
      border-radius:18px;
      font-weight:950;
      text-decoration:none;
      cursor:pointer;
      border:1px solid rgba(255,255,255,.22);
      background: rgba(0,0,0,.18);
      color:var(--txt);
      transition:transform .15s ease, opacity .15s ease, box-shadow .15s ease, filter .15s ease;
      will-change: transform;
    }
    .btn:hover{
      transform:translateY(-2px);
      opacity:.97;
      filter:saturate(120%);
      box-shadow:0 16px 34px rgba(0,0,0,.28);
    }
    .btn:active{ transform:translateY(0); }

    .btn-linkedin{
      background:var(--linkedin);
      color:#fff;
      border-color: rgba(255,255,255,.18);
    }

    .btn-animate{ position:relative; overflow:hidden; }
    .btn-animate::after{
      content:"";
      position:absolute;
      inset:-40% -30%;
      background: linear-gradient(120deg, transparent, rgba(255,255,255,.22), transparent);
      transform: translateX(-60%) rotate(12deg);
      transition: transform .6s ease;
      opacity:.7;
    }
    .btn-animate:hover::after{
      transform: translateX(60%) rotate(12deg);
    }

    .footer{
      margin-top:22px;
      font-size:13px;
      color:var(--muted);
    }

    .shake{ animation: pop .22s ease; }
    @keyframes pop{
      0%{ transform: scale(1); }
      60%{ transform: scale(1.012); }
      100%{ transform: scale(1); }
    }

    /* Banner audio */
    .audioBanner{
      position:fixed;
      left:16px;
      right:16px;
      bottom:16px;
      z-index:5;
      display:none;
      justify-content:center;
      align-items:center;
      gap:10px;
      padding:12px 14px;
      border-radius:18px;
      background: rgba(0,0,0,.45);
      border: 1px solid rgba(255,255,255,.18);
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 60px rgba(0,0,0,.35);
      color: var(--txt);
    }
    .audioBanner .mini{
      font-size:13px;
      color: var(--sub);
      opacity:.92;
    }

    /* Panel stats */
    .stats{
      margin-top:18px;
      text-align:left;
      max-width: 860px;
      margin-left:auto;
      margin-right:auto;
      border-top:1px solid rgba(255,255,255,.12);
      padding-top:16px;
    }
    .statsHead{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      margin-bottom:10px;
    }
    .statsTitle{
      font-weight:950;
      letter-spacing:.2px;
      color: var(--txt);
    }
    .statsControls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .input{
      appearance:none;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      color: var(--txt);
      padding:10px 12px;
      border-radius:14px;
      outline:none;
      font-weight:750;
      font-size:13px;
    }
    .input::-webkit-calendar-picker-indicator{ filter: invert(1); opacity:.85; }

    .chart{
      height:140px;
      display:flex;
      align-items:flex-end;
      gap:6px;
      padding:12px;
      border-radius:18px;
      background: rgba(0,0,0,.12);
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;
    }
    .bar{
      flex:1;
      min-width: 6px;
      border-radius: 12px 12px 8px 8px;
      background: linear-gradient(180deg, rgba(44,198,255,.90), rgba(255,108,201,.55));
      opacity:.9;
      transform: translateZ(0);
    }
    .bar:hover{ opacity:1; filter:saturate(120%); }
    .legend{
      margin-top:10px;
      font-size:13px;
      color: var(--muted);
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }

    @media (prefers-reduced-motion: reduce){
      .bg,.sheen,.dot,.cursor{ animation:none !important; }
      #snowCanvas{ display:none; }
      .btn,.pill{ transition:none !important; }
    }
  </style>
</head>

<body>
  <div class="bg"></div>
  <canvas id="snowCanvas" aria-hidden="true"></canvas>

  <!-- Audio local (suba el MP3 a la ra√≠z del repo: /visits/futuristic-beat-146661.mp3) -->
  <audio id="bgMusic" preload="auto" loop>
    <source src="./futuristic-beat-146661.mp3" type="audio/mpeg" />
  </audio>

  <div class="audioBanner" id="audioBanner">
    <div class="mini">üîä El navegador bloque√≥ el audio autom√°tico. Presione para activarlo.</div>
    <button class="btn btn-animate" id="btnEnableAudio" type="button">Activar audio</button>
    <button class="btn btn-animate" id="btnDismissAudio" type="button">Cerrar</button>
  </div>

  <main class="wrap">
    <section class="card" id="card">
      <div class="sheen"></div>

      <div class="toprow">
        <div class="badge">
          <span class="dot" id="statusDot"></span>
          <span id="statusText">Din√°mico ¬∑ activo</span>
        </div>
        <div class="badge" id="visitBadge">üëÅÔ∏è Visitas: <span id="visitCount">‚Äî</span></div>
        <div class="badge" id="audioState">üîá M√∫sica: OFF</div>
      </div>

      <div class="name">Alberto Lem</div>
      <div class="year">2026</div>

      <h1>‚ú® Le desea</h1>

      <p>
        Que este nuevo ciclo est√© lleno de salud, claridad, motivaci√≥n y oportunidades.
        Reciba este mensaje con aprecio y comp√°rtalo con quien considere que pueda necesitar
        un mensaje positivo en este a√±o 2026.
      </p>

      <div class="dynamic">
        <span id="dynamicMsg"></span><span class="cursor">|</span>
      </div>

      <div class="meta">
        <div class="pill" id="greetingPill">üïí --</div>
        <div class="pill" id="datePill">üìÖ --</div>
        <div class="pill" id="hintPill">‚ùÑÔ∏è Nieve: ON</div>
      </div>

      <div class="actions">
        <a class="btn btn-linkedin btn-animate"
           href="https://www.linkedin.com/in/alberto-lem?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=ios_app"
           target="_blank" rel="noopener">
          üíº Ver perfil en LinkedIn
        </a>

        <button class="btn btn-animate" id="btnNew" type="button">‚ú® Generar otro mensaje</button>
        <button class="btn btn-animate" id="btnCopy" type="button">üìã Copiar mensaje</button>
        <button class="btn btn-animate" id="btnMusic" type="button">üîä M√∫sica: AUTO</button>
      </div>

      <!-- ================== STATS (RANGO, HORA, MES) ================== -->
      <div class="stats" id="stats">
        <div class="statsHead">
          <div class="statsTitle">üìä Estad√≠sticas (desde su API)</div>
          <div class="statsControls">
            <input class="input" type="date" id="fromDate" />
            <input class="input" type="date" id="toDate" />
            <button class="btn btn-animate" id="btnLoadDaily" type="button">Ver por d√≠a</button>

            <input class="input" type="date" id="hourlyDate" />
            <button class="btn btn-animate" id="btnLoadHourly" type="button">Ver por hora</button>

            <input class="input" type="number" min="2020" max="2100" id="yearInput" />
            <button class="btn btn-animate" id="btnLoadMonthly" type="button">Ver por mes</button>
          </div>
        </div>

        <div class="chart" id="chartBars" aria-label="Gr√°fica"></div>
        <div class="legend">
          <div id="legendLeft">‚Äî</div>
          <div id="legendRight">‚Äî</div>
        </div>
      </div>

      <div class="footer">Mensaje personal compartido p√∫blicamente ¬∑ A√±o 2026</div>
    </section>
  </main>

  <script>
    /* ===================== CONFIG API (IMPORTANTE) ===================== */
    // Ajuste a su dominio real:
    const API_BASE = "https://api.systemblacklem.com";
    // PageKey del contador:
    const PAGE_KEY = "visits"; // o "dec-2026"

    // Endpoints esperados en su backend:
    // GET  /api/public/visits/track?page=visits
    // GET  /api/public/visits/stats/daily?page=visits&from=YYYY-MM-DD&to=YYYY-MM-DD
    // GET  /api/public/visits/stats/hourly?page=visits&date=YYYY-MM-DD
    // GET  /api/public/visits/stats/monthly?page=visits&year=YYYY
    const ENDPOINTS = {
      track:  `${API_BASE}/api/public/visits/track?page=${encodeURIComponent(PAGE_KEY)}`,
      daily:  (from, to) => `${API_BASE}/api/public/visits/stats/daily?page=${encodeURIComponent(PAGE_KEY)}&from=${from}&to=${to}`,
      hourly: (date)    => `${API_BASE}/api/public/visits/stats/hourly?page=${encodeURIComponent(PAGE_KEY)}&date=${date}`,
      monthly:(year)    => `${API_BASE}/api/public/visits/stats/monthly?page=${encodeURIComponent(PAGE_KEY)}&year=${year}`,
    };

    const MESSAGES = {
      morning: [
        "Que su ma√±ana inicie con enfoque, calma y determinaci√≥n.",
        "Que hoy comience con energ√≠a positiva y prop√≥sito claro."
      ],
      afternoon: [
        "Que su tarde contin√∫e con constancia y buenos resultados.",
        "Que cada paso de hoy le acerque a sus objetivos."
      ],
      evening: [
        "Que su noche le brinde paz, descanso y claridad.",
        "Que cierre el d√≠a con gratitud y serenidad."
      ],
      quotes: [
        "‚ÄúLa constancia construye resultados duraderos.‚Äù",
        "‚ÄúCada d√≠a es una oportunidad para avanzar.‚Äù",
        "‚ÄúLa disciplina transforma objetivos en logros.‚Äù",
        "‚ÄúQue 2026 sea un a√±o de crecimiento y claridad.‚Äù"
      ]
    };

    const $ = (id) => document.getElementById(id);

    function timeBand(h){
      if (h >= 5 && h < 12) return "morning";
      if (h >= 12 && h < 18) return "afternoon";
      return "evening";
    }
    function greeting(){
      const h = new Date().getHours();
      if (h >= 5 && h < 12) return "üå§Ô∏è Buenos d√≠as";
      if (h >= 12 && h < 18) return "‚òÄÔ∏è Buenas tardes";
      return "üåô Buenas noches";
    }
    function formatDate(){
      return new Date().toLocaleDateString("es-ES", {
        weekday:"long", year:"numeric", month:"long", day:"numeric"
      });
    }
    function pick(arr){ return arr[Math.floor(Math.random() * arr.length)]; }

    let typingTimer = null;
    function typewriter(el, text, speed = 16){
      clearInterval(typingTimer);
      el.textContent = "";
      let i = 0;
      typingTimer = setInterval(() => {
        el.textContent += text[i] ?? "";
        i++;
        if (i >= text.length) clearInterval(typingTimer);
      }, speed);
    }

    function updatePills(){
      $("greetingPill").textContent = greeting();
      $("datePill").textContent = "üìÖ " + formatDate();
    }

    function newMessage(animate = true){
      const now = new Date();
      const band = timeBand(now.getHours());
      const msg = pick(MESSAGES[band]) + " " + pick(MESSAGES.quotes);

      const el = $("dynamicMsg");
      if (animate) typewriter(el, msg, 16);
      else el.textContent = msg;

      updatePills();
    }

    function nudgeCard(){
      const card = $("card");
      card.classList.remove("shake");
      void card.offsetWidth;
      card.classList.add("shake");
    }

    $("btnNew").addEventListener("click", () => { nudgeCard(); newMessage(true); });
    $("btnCopy").addEventListener("click", async () => {
      const text = $("dynamicMsg").textContent.trim();
      try{
        await navigator.clipboard.writeText(text);
        setStatus("Copiado ‚úì", "ok");
      }catch(e){
        setStatus("No se pudo copiar", "err");
      }
      setTimeout(() => setStatus("Din√°mico ¬∑ activo", "info"), 1400);
    });

    window.addEventListener("keydown", (ev) => {
      if (ev.code === "Space"){
        ev.preventDefault();
        nudgeCard();
        newMessage(true);
      }
    });

    /* ===================== ESTADO UI ===================== */
    function setStatus(text, level){
      $("statusText").textContent = text;

      const dot = $("statusDot");
      dot.classList.remove("ok","warn","err");
      if (level === "ok") dot.classList.add("ok");
      else if (level === "warn") dot.classList.add("warn");
      else if (level === "err") dot.classList.add("err");
      else { /* info: color base */ }
    }

    /* ===================== NIEVE (Canvas) ===================== */
    const canvas = $("snowCanvas");
    const ctx = canvas.getContext("2d", { alpha:true });
    let flakes = [];
    let snowRAF = null;

    function resizeSnow(){
      canvas.width  = Math.floor(window.innerWidth  * devicePixelRatio);
      canvas.height = Math.floor(window.innerHeight * devicePixelRatio);
      canvas.style.width = "100vw";
      canvas.style.height = "100vh";
      ctx.setTransform(1,0,0,1,0,0);
      ctx.scale(devicePixelRatio, devicePixelRatio);
    }

    function makeFlakes(count = 120){
      flakes = Array.from({ length: count }, () => ({
        x: Math.random() * window.innerWidth,
        y: Math.random() * window.innerHeight,
        r: 0.8 + Math.random() * 2.2,
        vy: 0.6 + Math.random() * 1.8,
        vx: -0.35 + Math.random() * 0.7,
        wob: Math.random() * Math.PI * 2,
        woSpeed: 0.006 + Math.random() * 0.012,
        a: 0.25 + Math.random() * 0.55
      }));
    }

    function drawSnow(){
      ctx.clearRect(0,0, window.innerWidth, window.innerHeight);
      for (const f of flakes){
        f.wob += f.woSpeed;
        f.x += f.vx + Math.sin(f.wob) * 0.35;
        f.y += f.vy;

        if (f.y > window.innerHeight + 10) { f.y = -10; f.x = Math.random() * window.innerWidth; }
        if (f.x < -10) f.x = window.innerWidth + 10;
        if (f.x > window.innerWidth + 10) f.x = -10;

        ctx.beginPath();
        ctx.fillStyle = `rgba(255,255,255,${f.a})`;
        ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
        ctx.fill();
      }
      snowRAF = requestAnimationFrame(drawSnow);
    }

    function startSnow(){
      if (snowRAF) return;
      drawSnow();
    }
    function stopSnow(){
      if (!snowRAF) return;
      cancelAnimationFrame(snowRAF);
      snowRAF = null;
      ctx.clearRect(0,0, window.innerWidth, window.innerHeight);
    }

    document.addEventListener("visibilitychange", () => {
      if (document.hidden) stopSnow();
      else startSnow();
    });

    window.addEventListener("resize", () => {
      resizeSnow();
      makeFlakes(120);
    });

    /* ===================== M√öSICA (autoplay controlado) ===================== */
    const audio = $("bgMusic");
    const btnMusic = $("btnMusic");
    const audioState = $("audioState");
    const banner = $("audioBanner");

    let musicState = "AUTO"; // AUTO | ON | OFF

    function updateAudioUI(){
      if (musicState === "ON") {
        btnMusic.textContent = "üîä M√∫sica: ON";
        audioState.textContent = "üîä M√∫sica: ON";
      } else if (musicState === "OFF") {
        btnMusic.textContent = "üîá M√∫sica: OFF";
        audioState.textContent = "üîá M√∫sica: OFF";
      } else {
        btnMusic.textContent = "üîä M√∫sica: AUTO";
        audioState.textContent = "üîä M√∫sica: AUTO";
      }
    }

    async function tryAutoplay(){
      if (!audio) return;
      audio.volume = 0.65;
      try{
        await audio.play();
        musicState = "ON";
        banner.style.display = "none";
      }catch(e){
        musicState = "AUTO";
        banner.style.display = "flex";
      }
      updateAudioUI();
    }

    function stopMusic(){
      if (!audio) return;
      audio.pause();
      audio.currentTime = 0;
      musicState = "OFF";
      banner.style.display = "none";
      updateAudioUI();
    }

    async function startMusicByUser(){
      if (!audio) return;
      try{
        await audio.play();
        musicState = "ON";
        banner.style.display = "none";
      }catch(e){
        banner.style.display = "flex";
      }
      updateAudioUI();
    }

    btnMusic.addEventListener("click", () => {
      nudgeCard();
      if (musicState === "ON") stopMusic();
      else startMusicByUser();
    });

    $("btnEnableAudio").addEventListener("click", () => { nudgeCard(); startMusicByUser(); });
    $("btnDismissAudio").addEventListener("click", () => { stopMusic(); });

    function userGestureKick(){
      if (musicState === "AUTO") startMusicByUser();
      window.removeEventListener("pointerdown", userGestureKick);
      window.removeEventListener("keydown", userGestureKick);
    }
    window.addEventListener("pointerdown", userGestureKick);
    window.addEventListener("keydown", userGestureKick);

    /* ===================== TRACK VISIT + STATS (API REAL) ===================== */
    async function fetchJson(url){
      const res = await fetch(url, { method: "GET" });
      if (!res.ok) {
        const txt = await res.text().catch(() => "");
        throw new Error(`HTTP ${res.status} ${txt}`);
      }
      return res.json();
    }

    async function trackVisit(){
      try{
        const data = await fetchJson(ENDPOINTS.track);
        $("visitCount").textContent = String(data.total ?? "‚Äî");
        setStatus("Contador global ¬∑ OK", "ok");
      }catch(e){
        // Si falla API, no invente n√∫mero (mejor mostrar estado real)
        $("visitCount").textContent = "‚Äî";
        setStatus("API no disponible (contador)", "warn");
      }
    }

    function setDefaultDates(){
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, "0");
      const dd = String(today.getDate()).padStart(2, "0");
      const iso = `${yyyy}-${mm}-${dd}`;

      $("hourlyDate").value = iso;
      $("yearInput").value = String(yyyy);

      // rango: √∫ltimos 14 d√≠as
      const from = new Date(today.getTime() - 13 * 24 * 60 * 60 * 1000);
      const fyyyy = from.getFullYear();
      const fmm = String(from.getMonth() + 1).padStart(2, "0");
      const fdd = String(from.getDate()).padStart(2, "0");
      $("fromDate").value = `${fyyyy}-${fmm}-${fdd}`;
      $("toDate").value = iso;
    }

    function renderBars(points, titleLeft, titleRight){
      const container = $("chartBars");
      container.innerHTML = "";

      if (!points || points.length === 0){
        $("legendLeft").textContent = titleLeft;
        $("legendRight").textContent = "Sin datos";
        return;
      }

      const max = Math.max(...points.map(p => Number(p.value || 0)), 1);
      for (const p of points){
        const bar = document.createElement("div");
        bar.className = "bar";
        const val = Number(p.value || 0);
        const h = Math.max(6, Math.round((val / max) * 120));
        bar.style.height = `${h}px`;
        bar.title = `${p.key}: ${val}`;
        container.appendChild(bar);
      }

      const sum = points.reduce((a, p) => a + Number(p.value || 0), 0);
      $("legendLeft").textContent = titleLeft;
      $("legendRight").textContent = `${titleRight} ¬∑ Total: ${sum}`;
    }

    async function loadDaily(){
      const from = $("fromDate").value;
      const to = $("toDate").value;
      if (!from || !to){
        setStatus("Seleccione rango de fechas", "warn");
        return;
      }

      try{
        const data = await fetchJson(ENDPOINTS.daily(from, to));
        renderBars(data, `Por d√≠a (${from} a ${to})`, "Vistas");
        setStatus("Stats diarios ¬∑ OK", "ok");
      }catch(e){
        renderBars([], `Por d√≠a (${from} a ${to})`, "Error");
        setStatus("Error al cargar stats diarios", "err");
      }
    }

    async function loadHourly(){
      const date = $("hourlyDate").value;
      if (!date){
        setStatus("Seleccione una fecha", "warn");
        return;
      }

      try{
        const data = await fetchJson(ENDPOINTS.hourly(date));
        renderBars(data, `Por hora (${date} UTC)`, "Vistas");
        setStatus("Stats por hora ¬∑ OK", "ok");
      }catch(e){
        renderBars([], `Por hora (${date})`, "Error");
        setStatus("Error al cargar stats por hora", "err");
      }
    }

    async function loadMonthly(){
      const year = $("yearInput").value;
      const y = Number(year);
      if (!y || y < 2000 || y > 2100){
        setStatus("A√±o inv√°lido", "warn");
        return;
      }

      try{
        const data = await fetchJson(ENDPOINTS.monthly(y));
        renderBars(data, `Por mes (${y})`, "Vistas");
        setStatus("Stats mensual ¬∑ OK", "ok");
      }catch(e){
        renderBars([], `Por mes (${y})`, "Error");
        setStatus("Error al cargar stats mensual", "err");
      }
    }

    $("btnLoadDaily").addEventListener("click", () => { nudgeCard(); loadDaily(); });
    $("btnLoadHourly").addEventListener("click", () => { nudgeCard(); loadHourly(); });
    $("btnLoadMonthly").addEventListener("click", () => { nudgeCard(); loadMonthly(); });

    /* ===================== INIT ===================== */
    newMessage(true);
    updatePills();

    resizeSnow();
    makeFlakes(120);
    startSnow();

    updateAudioUI();
    tryAutoplay();

    setDefaultDates();
    trackVisit();   // ‚úÖ contador global real desde su API
    loadDaily();    // ‚úÖ carga inicial: √∫ltimos 14 d√≠as
  </script>
</body>
</html>


